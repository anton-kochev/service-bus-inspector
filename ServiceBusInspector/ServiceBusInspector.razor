@using global::ServiceBusInspector.Components
@using RazorConsole.Components
@using Spectre.Console
@using Align = RazorConsole.Components.Align
@using Markup = RazorConsole.Components.Markup


<Panel>
    <Align Horizontal="HorizontalAlignment.Center">
        <Padder Padding="new Padding(2, 1, 2, 1)">
            <Markup Content="SERVICE BUS INSPECTOR" Foreground="Color.Grey58" Decoration="Decoration.Bold"></Markup>
        </Padder>
    </Align>

    <Align Horizontal="@HorizontalAlignment.Center">
        <Markup Content="Tab to change focus • Enter to submit • Ctrl+C to exit" Foreground="@Color.Grey58"/>
    </Align>

    @if (_showingQueueInput)
    {
        <Padder Padding="new Padding(2, 1, 2, 1)">
            <ChangeQueueInput @bind-QueueName="_newQueueName"
                              OnSubmit="@OnSubmitQueueChange"
                              OnCancel="@OnCancelQueueChange"/>
        </Padder>
    }

    @if (!_showingQueueInput)
    {
        <!-- Navigation and Actions -->
        <Align Horizontal="HorizontalAlignment.Center">
            <Panel Border="BoxBorder.Rounded">
                <TextButton Content="Peek messages" OnClick="@OnPeekMessages"
                            FocusedColor="Color.Yellow"/>
                <Markup Content=" | "></Markup>
                <TextButton Content="Reset queue" OnClick="@OnResetQueue"
                            FocusedColor="Color.Yellow"/>
                <Markup Content=" | "></Markup>
                <TextButton Content="Change queue" OnClick="@OnChangeQueue"
                            FocusedColor="Color.Yellow"/>
            </Panel>
        </Align>

        <!-- Message Queue Display -->
        <Grid Expand="true" Columns="2">
            <MessageListPanel Title="@($"{App.QueueName}")"
                              Messages="@StateValue.MainQueueMessages"
                              ErrorMessage="@StateValue.PeekError"
                              OnMessageSelected="@OnMessageSelected"/>

            <MessageListPanel Title="Dead Letter Queue"
                              Messages="@StateValue.DeadLetterQueueMessages"
                              ErrorMessage="@StateValue.PeekError"
                              OnMessageSelected="@OnMessageSelected"/>
        </Grid>

        <!-- Message Details -->
        <MessageDetailsTable Message="@StateValue.SelectedMessage"/>
    }

    <!-- Footer -->
</Panel>

<!-- Status Messages -->
<StatusMessageDisplay WarningMessage="@StateValue.WarningMessage"
                      SuccessMessage="@StateValue.SuccessMessage"/>

<Align Horizontal="HorizontalAlignment.Right">
    <Columns>
        <MetricsPanel Metrics="@StateValue.Metrics"/>
        <Markup Content="|"></Markup>
        <Markup Content="@($"Delay {App.RefreshIntervalSeconds}s")" Foreground="@Color.Grey58"/>
        <Markup Content="|"></Markup>
        <Markup Content="@($"{DateTime.UtcNow:HH:mm:ss} (UTC)")" Foreground="@Color.Grey58"/>
    </Columns>
</Align>
